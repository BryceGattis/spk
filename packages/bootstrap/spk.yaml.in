# use a low version and explicit bootstrap tag to be clear
pkg: NAME/0.0.0+bootstrap.1
api: v0/package

sources: [] # no source package files

build:
  # this is an empty package which just assumes that NAME is installed and
  # available to be used, hence the bootstrapping idea...
  # Usually this package is only used to satisfy the dependencies of the
  # real NAME package which requires itself to build itself
  options:
    - var: arch
    - var: os
    - var: distro
    - var: centos
    - pkg: stdfs
    - var: bootstrapped/yes
      inheritance: Strong
      description: >
        this package or a dependency was generated by bootstrapping a
        system package and may not work on other hosts
  script: |
    if ! rpm -q NAME; then
      echo "NAME is not installed on this system"
      exit 1
    fi
    files="$(rpm -ql NAME | grep -v /doc/ | grep -v /lib/ || : )"
    mkdir -p /spfs/share/aclocal
    for file in $files; do
      [ -f $file ] || continue
      newfile=/spfs/${file/\/usr\//}
      mkdir -p $(dirname $newfile)
      if [ -L $file ]; then
        target=$(readlink $file)
        newtarget=${target/\/usr/\/spfs}
        ln -s $newtarget $newfile
      else
        cp $file $newfile
      fi
    done
    [ ! -e /spfs/share/info ] || rm -r /spfs/share/info

install:
  requirements:
    - pkg: stdfs
