pkg: spk/0.1.0

build:
  options:
    - var: arch
    - var: os
      choices: [linux]
    - pkg: python
      static: 3.7
    - pkg: pytest
    - pkg: mypy
    - { pkg: black, prereleasePolicy: IncludeAll }
    - { pkg: nuitka, default: =0.6.7 }
    - pkg: pytest-mypy
    - pkg: pytest-cov
    - { pkg: spfs, default: 0.20.10 }
    - { pkg: ruamel-yaml, default: 0.16.10 }
    - { pkg: colorama, default: 0.4.3 }
    - { pkg: typing-extensions, default: 3.7 }
    - { pkg: simplejson, default: 3.17 }
    - { pkg: semver, default: 2.9 }
    - { pkg: structlog, default: 19.2 }
    - { pkg: spops, default: 0.1.11 }
    - { pkg: sortedcontainers, default: 2.1 }
    - { pkg: pytz, default: ">=2020" }
    - { pkg: cerberus, default: 1.3 }
  script:
    - export PYTHONDONTWRITEBYTECODE=1
    - /spfs/bin/python -m pip install --no-deps .

install:
  requirements:
    - { pkg: spfs, fromBuildEnv: x.x }
    - { pkg: ruamel-yaml, fromBuildEnv: x.x }
    - { pkg: colorama, fromBuildEnv: x.x }
    - { pkg: typing-extensions, fromBuildEnv: x.x }
    - { pkg: simplejson, fromBuildEnv: x.x }
    - { pkg: semver, fromBuildEnv: x.x }
    - { pkg: structlog, fromBuildEnv: x.x }
    - { pkg: spops, fromBuildEnv: x.x }
    - { pkg: sortedcontainers, fromBuildEnv: x.x }
    - { pkg: pytz, fromBuildEnv: ">=x.x" }
    - { pkg: cerberus, fromBuildEnv: x.x }
    - { pkg: pyparsing }

tests:
  - stage: sources
    script:
      - pwd
      - test -f .spdev.yaml
  - stage: build
    script: /spfs/bin/python -m "spk" --help
  - stage: install
    script:
      - $PREFIX/bin/spk --help
